check:
  test:
    - has_file: pom.xml
  goals:
    - autofix
    - version
---
build:
  test:
    - has_file: pom.xml
  depends_on: check
  goals:
    - containers:
        - args:
            - "-c"
            - >-
              mvn --batch-mode -Dmaven.repo.local=.m2 versions:set -DnewVersion="$ATOMIST_VERSION" versions:commit &&
              mvn --batch-mode -Dmaven.repo.local=.m2 --show-version package
          command:
            - bash
          image: maven:3.6.3-jdk-8
          name: maven
          resources:
            limits:
              cpu: 1000m
              memory: 2048Mi
            requests:
              cpu: 100m
              memory: 1024Mi
            securityContext:
              runAsGroup: 0
              runAsNonRoot: false
              runAsUser: 0
      input:
        - ${push.repo.owner}/m2
      output:
        - classifier: ${push.repo.owner}/m2
          pattern:
            directory: .m2
        - classifier: ${push.repo.owner}/${push.repo.name}/${push.sha}/pom
          pattern:
            globPattern: pom.xml
        - classifier: ${push.repo.owner}/${push.repo.name}/${push.sha}/target
          pattern:
            directory: target
